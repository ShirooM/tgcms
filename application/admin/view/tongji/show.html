<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>访问统计</title>
    {include file="public/head" /}
    {include file="public/css" /}
</head>
<body>
<div id="app">
    <div class="layui-layout layui-layout-admin">
        {include file="public/nav-top" /}
        {include file="public/nav-left" /}
        <div class="layui-body">
            <div class="layui-card">
                <div class="layui-card-header">访问统计</div>
                <div class="layui-card-body">
                    <form class="layui-form" action="">
                        <div class="layui-form-item">
                            <label class="layui-form-label">站点</label>
                            <div class="layui-input-inline">
                                <select name="domain" lay-verify="">
                                    <option value="">全部站点</option>
                                    {volist name="domains" id="vo"}
                                    <option value="{$vo.domain_url}">{$vo.domain_url}</option>
                                    {/volist}
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">渠道</label>
                            <div class="layui-input-inline">
                                <select name="source" lay-verify="">
                                    <option value="">全部渠道</option>
                                    <option value="baidu">baidu</option>
                                    <option value="sogou">sogou</option>
                                    <option value="sm">sm</option>
                                    <option value="360">360</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">设备</label>
                            <div class="layui-input-block">
                                <input type="radio" name="device" value="all" title="全部" checked>
                                <input type="radio" name="device" value="pc" title="PC">
                                <input type="radio" name="device" value="yd" title="YD">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">时间</label>
                                <div class="layui-input-inline" style="width: 120px;">
                                    <input type="text" name="start_time" class="layui-input" id="start_time" autocomplete="off" v-model="startTime">
                                </div>
                                <div class="layui-form-mid">-</div>
                                <div class="layui-input-inline" style="width: 120px;">
                                    <input type="text" name="end_time" class="layui-input" id="end_time" autocomplete="off" v-model="endTime">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button class="layui-btn" lay-submit lay-filter="formDemo">立即查询</button>
                                <button type="reset" class="layui-btn layui-btn-primary" @click="exportFile">导出数据</button>
                            </div>
                        </div>
                    </form>
                    <div style="margin-top: 10px;">数据概括</div>
                    <hr class="layui-bg-green">
                    <div class="layui-card">
                        <div class="layui-card-body">
                            <div class="layui-row layui-col-space10">
                                <div class="layui-col-sm4">
                                    <span>访客数：{$todayCount}</span>
                                </div>
                                <div class="layui-col-sm4">
                                    <span>转化数：{$zhCount}</span>
                                </div>
                                <div class="layui-col-sm4">
                                    <span>转化率：{$zhl}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>访问明细</div>
                    <hr class="layui-bg-green">
                    <table id="data_list" lay-filter="data_list"></table>

                </div>
            </div>
        </div>
        {include file="public/footer" /}
    </div>
</div>
{include file="public/js" /}

<script>
    var layer,table,laydate,openIndex,tableIns;
    var app = new Vue({
        el: "#app",
        data: {
            domainURL:"",
            source:"",
            device:"",
            startTime:"",
            endTime:""
        },
        watch:{
            startTime:function (val,oldVal) {

            },
            endTime:function (val,oldVal) {

            }
        },
        methods:{
              exportFile:function () {
                  table.exportFile(tableIns.config.id);
              }
        },
        created: function () {
            layui.use(['element', 'layer', 'table','laydate'], function () {
                layer = layui.layer;
                table = layui.table;
                laydate=layui.laydate;

                var ins1=laydate.render({
                    elem:"#start_time",
                    value:new Date()
                });

                laydate.render({
                    elem:"#end_time",
                    value:new Date()
                });

                tableIns=table.render({
                    elem: '#data_list',
                    url: '{:url("admin/tongji/show")}',//数据接口
                    where:{
                        domain_url:"",
                        source:"",
                        device:"",
                        start_time:"",
                        end_time:""
                    },
                    method: 'post',
                    loading: true,
                    page: true,//开启分页
                    cols: [[
                        {field: 'tj_domain', title: '受访站点', minWidth: 150},
                        {field: 'tj_page_name', title: '受访页面', minWidth: 100},
                        {field: 'tj_create_time', title: '访问时间', minWidth: 180},
                        {field: 'tj_device', title: '设备', minWidth: 50},
                        {field: 'tj_ip', title: '访问IP', minWidth: 150},
                        {field: 'tj_source', title: '渠道', minWidth: 100},
                        {field: 'tj_keyword', title: '关键词', minWidth: 150},
                        {field: 'tj_zhuanhua', title: '转化', minWidth: 50}
                    ]]
                });
            });
        },
        updated:function () {
            console.log("updated");
        }
    });
</script>
</body>
</html>